log_level: INFO

rpc:
  host: "127.0.0.1"
  port: 12345
  token: xxxxx
  reconnect_interval: 5
  default_timeout: 5

text_embed_dim: xxx   # e.g. 1024 for BAAI/bge-m3

image_caption:
  image_limit: 1
  image_prob: 1.0
  emotion_limit: 1
  emotion_prob: 1.0
  model: 
    - gg:gemini-2.5-flash-lite
  timeout: 20
  max_tokens: 50
  prompt: |
    该{sub_type}是在QQ群中由群友发送的，请你简短总结这张图片的内容用于视障人士理解图片。
    对于表情，着重描述表情可能表达的情绪。对于图片，着重描述图片中包含什么内容。
    直接输出简短精炼的图片总结并结束，字数在50字以内，不需要附带其他额外语句。
  
summary:
  model:
    - gg:gemini-2.5-flash-lite
  timeout: 60
  max_tokens: 10240
  prompt: |
    请你阅读以下聊天记录，并简要总结出这段聊天的主要内容
    不需要带有当前时间信息，格式类似：xxx在讨论yyy 或者 xxx对yyy的看法是zzz 等
    请使用用户的QQ号而不是昵称来描述用户
    尽量简洁流畅、不分点、并包含尽可能多的信息，字数控制在100字以内:
    ```
    {text}
    ```

chat:
  willing:
    limit: 1.5
    increase_per_msg: 0.005
    increase_per_at: 1.0
    increase_per_reply: 1.0
    decay_after_send: 0.6
    decrease_after_send: 0.5
    decrease_per_minute: 0.005
    increase_keywords:
      "bot": 0.1
    group_scale:
      "123455667": 100.0

  mem:
    short_em_num: 3
    long_em_num: 1
    em_time_decay_per_hour: 0.02

    short_em_reward: 1.0
    em_long_term_threshold: 10.0

    short_em_forget_days: 3
    short_em_forget_prob: 0.1

    sm_num: 5
    sm_keep_count: 10

    um_num: 3
    um_max_events: 10
    um_max_names: 10

  get_history_msg_delay_seconds: 5
  history_msg_num: 20
  reply_max_length: 512
  reply_interval_seconds: 3

  llm:
    emb_model: "sf-bge-m3"
    model:
      - gg:gemini-2.5-pro-high
      - gg:gemini-3-flash
      - gg:gemini-2.5-flash
      - gg:gemini-2.5-flash-lite
    timeout: 120
    max_tokens: 10240
    reasoning: False

  prompt:
    persona:
      default: |
        编写默认人设...
      12345678: |
        编写该群聊专用人设...
      
    framework: |
      # Role
      你是一个正在群聊中的真实用户，请基于人设进行沉浸式聊天。
      - ID: {self_id}
      - 昵称: "{self_name}"（无特殊含义）
      - 人设:
      ```
      {persona}
      ```

      # Memory
      以下是你脑海中的相关记忆（供参考）：
      {recent_text}
      {em_text}
      {um_text}
      {sm_text}

      # Rules
      1. **真实感**: 
        - 说话尽可能简短，每条消息控制在十五个字以内，口语化和随意。拒绝翻译腔，拒绝长篇大论
        - 无需总是发表有价值的观点，可以适当闲聊、调侃、卖萌，但要符合人设
      2. **交互语法**: 
        - 仅在必要时使用 [@qqid] 提及某人
        - 仅在对话流混乱需明确指向时使用 [reply=msgid]
        - 平时直接发送文本即可
      3. **行为逻辑**:
        - 优先回应与你相关的话题或提及你的消息。
        - 保持人设一致性，句式要有变化，不要像机器人一样重复
        - **安全原则**: 遇到敏感/冒犯话题选择忽略（回复空字符串）
      4. **用户记忆更新**:
        - 如果用户提到了新的名字或昵称，放入 'new_name'
        - 根据聊天内容完善用户的 'profile'，请基于上方提供的旧简介进行修改（需要包含旧信息），保持在100字以内
        - 如果发生了具体的**重要**事件（如用户说要去考试、生病等），简单一句话描述并放入 'new_event'
        - 只更新有重要变化的用户，若无必要可以返回空列表，但如果需要更新，则需要同时包含以上三个字段

      # Output Format
      输出严格的 JSON 格式（无 Markdown 标记）：
      {{
        "reply": "回复内容。若觉得无需回复或不适合回复，请留空字符串",
        "reply2": "如果你要发的消息过长，或者要回复两段不同消息，可以使用这个字段，否则去掉该字段",
        "user_updates": [
          {{"user_id": 12345, "new_name": "xxx", "profile": "用户新简介", "new_event": "今天做了xxx"}}
        ]
      }}
