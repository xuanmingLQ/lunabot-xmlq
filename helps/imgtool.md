# 图片处理服务 (imgtool)

提供一些图片处理相关功能

---

## 指令目录

标记 🛠️ 的指令仅限超级管理使用

- [图片处理](#图片处理)
- [查看图片处理操作帮助](#查看图片处理操作帮助)
- [检查图片属性](#检查图片属性)
- [添加图片到列表](#添加图片到列表)
- [从列表移除图片](#从列表移除图片)
- [清空图片列表](#清空图片列表)
- [翻转图片列表](#翻转图片列表)
- [二维码识别](#二维码识别)
- [生成二维码](#生成二维码)
- [生成群友语录](#生成群友语录)
- [Markdown转图片](#markdown转图片)
- [颜色展示](#颜色展示)
- [图片取色](#图片取色)
- [视频转GIF](#视频转gif)


## 图片操作目录

- [转gif(gif)](#转gifgif)
- [转png(png)](#转pngpng)
- [镜像(mirror)](#镜像mirror)
- [旋转(rotate)](#旋转rotate)
- [倒放(back)](#倒放back)
- [加速(speed)](#加速speed)
- [对称(mid)](#对称mid)
- [缩放(resize)](#缩放resize)
- [裁剪(crop)](#裁剪crop)
- [灰度(gray)](#灰度gray)
- [反转(invert)](#反转invert)
- [流动(flow)](#流动flow)
- [转动(fan)](#转动fan)
- [重复(repeat)](#重复repeat)
- [拼接(concat)](#拼接concat)
- [合成动图(stack)](#合成动图stack)
- [提取帧(extract)](#提取帧extract)
- [生成幻影坦克(mirage)](#生成幻影坦克mirage)
- [还原幻影坦克(demirage)](#还原幻影坦克demirage)
- [亮度(brighten)](#亮度brighten)
- [对比度(contrast)](#对比度contrast)
- [锐度(sharpen)](#锐度sharpen)
- [饱和度(saturate)](#饱和度saturate)
- [模糊(blur)](#模糊blur)
- [抠图(cutout)](#抠图cutout)
- [裁剪透明(shrink)](#裁剪透明shrink)
- [添加背景(bg)](#添加背景bg)


---

## 指令

### 图片处理
`/img`
> 单张图片处理：  
回复一张图片，进行一系列图片处理操作  
处理单张图片的方式为 "(回复一张图片) /img 操作1 参数1 操作2 参数2..."  
操作之间只要输出输出类型对应就可以任意连接   
可用的操作见图片操作目录  
处理多张图片的方式：  
1.可以回复包含多张图片的消息，或者回复包含多张图片的折叠消息   
使用方式为 "(回复多张图片) /img 操作1 参数1 操作2 参数2..."  
2.也可以先使用 "/img push" 添加图片  
再直接使用 "/img 操作1 参数1 操作2 参数2..."  

- `(回复一张图片) /img rotate 90` 逆时针旋转90度
- `(回复一张图片) /img rotate 90 resize 0.5x` 逆时针旋转90度，再缩小到50%
- `(回复多张图片) /img concat` 将多张图片垂直拼接成一张图片
- `/img concat` 将当前列表中的多张图片垂直拼接成一张图片


### 查看图片处理操作帮助
`/img help`
> 查看某个图片操作的帮助信息  

- `/img help rotate` 查看rotate操作的帮助信息


### 检查图片属性
`/img check` `/img info`
> 获取图片分辨率等属性  

- `(回复一张图片) /img check`


### 添加图片到列表
`/img push`
> 将图片添加到列表，供多张图片处理使用  
可以回复带有图片的消息或者带有图片的折叠消息，并且可以翻转顺序  

- `(回复一张图片) /img push`
- `(回复多张图片) /img push` 按照图片在消息中的顺序添加到列表
- `(回复多张图片) /img push r` 翻转图片顺序再添加到列表


### 从列表移除图片
`/img pop`
> 从列表中移除最后的一张图片  


### 清空图片列表
`/img clear`
> 清空图片列表  


### 翻转图片列表
`/img rev`
> 翻转图片列表  


### 二维码识别
`/scan` `/扫描` `/识别`
> 识别图片中的二维码  

- `(回复一张图片) /scan`


### 生成二维码
`/qrcode` `/二维码`
> 生成二维码图片  

- `/qrcode https://example.com`


### 生成群友语录
`/语录` `/quote` `/saying`
> 生成群友语录图片  

- `(回复一条消息) /语录`


### Markdown转图片
`/md` `/markdown`
> 将Markdown文本转换为图片  

- `(回复一条消息) /md`


### 颜色展示
`/color` `/颜色`
> 展示十六进制rgb、整数rgb、浮点数rgb 或者 hsl格式的颜色

- `/color #FF0000` 
- `/color rgb 255 0 0` 
- `/color rgbf 1.0 0.0 0.0` 
- `/color hsl 0 100% 50%`


### 图片取色
`/pick` `/取色`
> 从图片中提取比例最大的颜色  

- `(回复一张图片) /pick` 默认提取10种颜色
- `(回复一张图片) /pick 5` 提取5种颜色


### 视频转GIF
`/gif`
> 将视频转换为GIF图片，会自动缩小视频分辨率和帧数  

- `(回复一条视频消息) /gif`


---

## 图片操作


### 转gif(gif)
`静态图` -> `静态图`
> 将一张静态图片转换为gif图。可以用于制作表情  
QQ无法正确显示带有透明部分png格式图片，转换为gif后可以正常显示  
注意转换过程中会出现不可避免的质量损失，并且不能显示半透明    
默认使用优化算法，可以指定不透明度阈值（默认50%）  

- `gif n` 使用普通算法生成GIF
- `gif` 使用优化算法以默认50%不透明度阈值生成GIF
- `gif 0.3` 使用优化算法以30%不透明度阈值生成GIF


### 转png(png)
`静态图` -> `静态图`
> 将一张静态图片转换为png图  
可用于保存无法qq直接下载的gif图  

- `png` 将一张图片转换为png格式


### 镜像(mirror)
`任意` -> `任意`
> 将一张图片进行镜像翻转  

- `mirror` 水平镜像翻转
- `mirror v` 垂直镜像翻转


### 旋转(rotate)
`任意` -> `任意`
> 将图片逆时针旋转指定角度

- `rotate 90` 逆时针旋转90度


### 倒放(back)
`任意` -> `任意`
> 在时间轴上反转动图

- `back` 将动图倒放


### 加速(speed)
`任意` -> `任意`
> 调整动图速度，调整速度过快会进行抽帧

- `speed 2x` 加速到2倍速
- `speed -2x` 加速到2倍速并倒放
- `speed 0.5x` 减速到0.5倍速
- `speed 50` 设置帧时长为50ms


### 对称(mid)
`任意` -> `任意`
> 生成对称效果，将图片的一侧镜像黏贴到另一侧

- `mid` 左边翻转到右边
- `mid r` 右边翻转到左边
- `mid v` 上面翻转到下面
- `mid v r` 下面翻转到上面


### 缩放(resize)
`任意` -> `任意`
> 缩放图片到指定大小或比例

- `resize 0.5x` 缩小到50%
- `resize 100` 保持宽高比缩放到长边为100
- `resize 2x 0.5x` 宽放大2倍，高缩小50%
- `resize 100 100` 调整到长宽为 100x100


### 裁剪(crop)
`任意` -> `任意`
> 裁剪图片，参数中使用实数（带有小数点）或者百分比则对应比例，使用整数则对应像素

- `crop 100x100` 裁剪图片100x100中间部分
- `crop 0.5x0.5` 裁剪图片中心长宽为原来50%的部分
- `crop 50%x100` 裁剪图片中心长为原来50%，宽为100px的部分
- `crop 100x100 l` 裁剪图片100x100左边部分(lrtb:左右上下)
- `crop 100x100 lt` 裁剪图片100x100左上角部分
- `crop 100x100 50x50` 裁剪图片100x100，相对左上角偏移(50,50)px
- `crop l0.1 t0.2` 裁剪掉图片左边10%，上边20%部分


### 灰度(gray)
`任意` -> `任意`
> 将图片转换为灰度图

- `gray` 将图片转换为灰度图


### 反转(invert)
`任意` -> `任意`
> 将图片颜色反转

- `invert` 将图片颜色反转


### 流动(flow)
`任意` -> `动图`
> 生成流动效果动图

- `flow` 从左到右流动
- `flow v` 从上到下流动
- `flow r` 从右到左流动
- `flow v r` 从下到上流动
- `flow v r 2x` 从下到上流动，速度为2倍


### 转动(fan)
`任意` -> `动图`
> 生成转动效果动图

- `fan` 逆时针旋转
- `fan r` 顺时针旋转
- `fan 2x` 逆时针2倍速旋转


### 重复(repeat)
`任意` -> `任意`
> 将图片重复

- `repeat 1 2` 横向重复1次，纵向重复2次
- `repeat 2 3` 横向重复2次，纵向重复3次


### 拼接(concat)
`多张图片` -> `静态图`
> 将多张图片拼接成一张图片

- `concat` 将多张图片垂直拼接成一张图片
- `concat h` 将多张图片水平拼接成一张图片
- `concat g` 将多张图片网格拼接


### 合成动图(stack)
`多张图片` -> `动图`
> 将多张图片合成一张动图

- `stack` 将多张图片合成一张动图，帧率为20fps
- `stack 10` 将多张图片合成一张动图，帧率为10fps


### 提取帧(extract)
`动图` -> `多张图片`
> 从动图中提取帧

- `extract` 提取出动图的帧，帧数量过多时会自动抽掉部分帧
- `extract 2` 以2帧为间隔提取出动图的帧


### 生成幻影坦克(mirage)
`多张图片 -> 静态图`
> 生成幻影坦克

- `mirage` 使用图片列表倒数第二张作为表面图，倒数第一张作为隐藏图
- `mirage r` 使用图片列表倒数第一张作为表面图，倒数第二张作为隐藏图


### 还原幻影坦克(demirage)
`静态图` -> `多张图片`
> 还原幻影坦克，提取出表面图和隐藏图

- `demirage` 还原幻影坦克


### 亮度(brighten)
`任意` -> `任意`
> 调整图片的亮度，参数0对应全黑图片，参数1对应原图

- `brighten 0.5` 降低图片亮度50%
- `brighten 1.5` 提高图片亮度50%


### 对比度(contrast)
`任意` -> `任意`
> 调整图片的对比度，参数0对应全灰图片，参数1对应原图

- `contrast 0.5` 降低图片对比度50%
- `contrast 1.5` 提高图片对比度50%


### 锐度(sharpen)
`任意` -> `任意`
> 调整图片的锐度，参数0对应无锐化图片，参数1对应原图，参数2对应锐化图片

- `sharpen 0.5` 降低图片锐度50%
- `sharpen 1.5` 提高图片锐度50%


### 饱和度(saturate)
`任意` -> `任意`
> 调整图片的饱和度，参数0对应黑白图片，参数1对应原图

- `saturate 0.5` 降低图片饱和度50%
- `saturate 1.5` 提高图片饱和度50%


### 模糊(blur)
`任意` -> `任意`
> 对图片应用高斯模糊

- `blur` 应用默认半径为3的高斯模糊
- `blur 5` 应用半径为5的高斯模糊


### 抠图(cutout)
`任意` -> `任意`
> 抠图，可用算法：    
floodfill（默认）: 洪水算法抠图，用于移除纯色背景   
ai: ai抠图    
洪水算法抠图时可以指定容差，默认为20  

- `cutout` 使用洪水算法抠图，容差为20
- `cutout 50` 使用洪水算法抠图，容差为50
- `cutout ai` 使用ai抠图


### 裁剪透明(shrink)
`任意` -> `任意`
> 裁剪透明，将图像边缘透明部分裁剪掉  

- `shrink` 裁剪透明部分，默认透明度阈值为10（alpha小于等于阈值的像素被认为是透明）
- `shrink 50` 裁剪透明部分，透明度阈值为50
- `shrink 10 +10` 裁剪透明部分，透明度阈值为10，并在裁剪区域外扩展10像素


### 添加背景(bg)
`任意` -> `任意`
> 为图片添加背景颜色，适用于带有透明部分的图片

- `bg` 使用默认白色作为背景颜色
- `bg #FFFFFF` 使用颜色代码
- `bg 255 0 0` 使用RGB整数值


---

[回到帮助目录](./main.md)